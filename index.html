<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Evaluate Function Calls on HPC Schedulers (LSF, SGE, SLURM, PBS/Torque) • clustermq</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Evaluate Function Calls on HPC Schedulers (LSF, SGE, SLURM, PBS/Torque)">
<meta name="description" content="Evaluate arbitrary function calls using workers on HPC schedulers in single line of code. All processing is done on the network without accessing the file system. Remote schedulers are supported via SSH.">
<meta property="og:description" content="Evaluate arbitrary function calls using workers on HPC schedulers in single line of code. All processing is done on the network without accessing the file system. Remote schedulers are supported via SSH.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">clustermq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="articles/userguide.html">User Guide</a></li>
<li class="nav-item"><a class="nav-link" href="articles/technicaldocs.html">Technical Documentation</a></li>
<li class="nav-item"><a class="nav-link" href="articles/faq.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mschubert/clustermq"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="clustermq-send-r-function-calls-as-cluster-jobs">ClusterMQ: send R function calls as cluster jobs<a class="anchor" aria-label="anchor" href="#clustermq-send-r-function-calls-as-cluster-jobs"></a>
</h1></div>
<p><a href="https://cran.r-project.org/package=clustermq" class="external-link"><img src="https://www.r-pkg.org/badges/version/clustermq" alt="CRAN version"></a> <a href="https://github.com/mschubert/clustermq/actions" class="external-link"><img src="https://github.com/mschubert/clustermq/actions/workflows/check-standard.yaml/badge.svg" alt="Build Status"></a> <a href="https://cran.r-project.org/package=clustermq" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/clustermq" alt="CRAN downloads"></a> <a href="https://doi.org/10.1093/bioinformatics/btz284" class="external-link"><img src="https://zenodo.org/badge/DOI/10.1093/bioinformatics/btz284.svg" alt="DOI"></a></p>
<p>This package will allow you to send function calls as jobs on a computing cluster with a minimal interface provided by the <code>Q</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install the package if you haven't done so yet</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'clustermq'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the library and create a simple function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mschubert.github.io/clustermq/" class="external-link">clustermq</a></span><span class="op">)</span></span>
<span><span class="va">fx</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># queue the function call on your scheduler</span></span>
<span><span class="fu"><a href="reference/Q.html">Q</a></span><span class="op">(</span><span class="va">fx</span>, x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n_jobs<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># list(2,4,6)</span></span></code></pre></div>
<p>Computations are done <a href="https://zeromq.org/" class="external-link">entirely on the network</a> and without any temporary files on network-mounted storage, so there is no strain on the file system apart from starting up R once per job. All calculations are load-balanced, i.e. workers that get their jobs done faster will also receive more function calls to work on. This is especially useful if not all calls return after the same time, or one worker has a high load.</p>
<p>Browse the vignettes here:</p>
<ul>
<li><a href="https://mschubert.github.io/clustermq/articles/userguide.html" class="external-link">User Guide</a></li>
<li><a href="https://mschubert.github.io/clustermq/articles/technicaldocs.html" class="external-link">Technical Documentation</a></li>
<li><a href="https://mschubert.github.io/clustermq/articles/faq.html" class="external-link">FAQ</a></li>
</ul>
<div class="section level2">
<h2 id="schedulers">Schedulers<a class="anchor" aria-label="anchor" href="#schedulers"></a>
</h2>
<p>An HPC cluster’s scheduler ensures that computing jobs are distributed to available worker nodes. Hence, this is what clustermq interfaces with in order to do computations.</p>
<p>We currently support the <a href="https://mschubert.github.io/clustermq/articles/userguide.html#configuration" class="external-link">following schedulers</a> (either locally or via SSH):</p>
<ul>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#local-parallelization" class="external-link">Multiprocess</a> - <em>test your calls and parallelize on cores using</em> <code>options(clustermq.scheduler="multiprocess")</code>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#slurm" class="external-link">SLURM</a> - <em>should work without setup</em>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#lsf" class="external-link">LSF</a> - <em>should work without setup</em>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#sge" class="external-link">SGE</a> - <em>may require configuration</em>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#pbs" class="external-link">PBS</a>/<a href="https://mschubert.github.io/clustermq/articles/userguide.html#torque" class="external-link">Torque</a> - <em>needs</em> <code>options(clustermq.scheduler="PBS"/"Torque")</code>
</li>
<li>via <a href="https://mschubert.github.io/clustermq/articles/userguide.html#ssh-connector" class="external-link">SSH</a> - <em>needs</em> <code>options(clustermq.scheduler="ssh", clustermq.ssh.host=&lt;yourhost&gt;)</code>
</li>
</ul>
<blockquote>
<p>[!TIP] Follow the links above to configure your scheduler in case it is not working out of the box and check the <a href="https://mschubert.github.io/clustermq/articles/faq.html" class="external-link">FAQ</a> if your job submission errors or gets stuck</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The most common arguments for <code>Q</code> are:</p>
<ul>
<li>
<code>fun</code> - The function to call. This needs to be self-sufficient (because it will not have access to the <code>master</code> environment)</li>
<li>
<code>...</code> - All iterated arguments passed to the function. If there is more than one, all of them need to be named</li>
<li>
<code>const</code> - A named list of non-iterated arguments passed to <code>fun</code>
</li>
<li>
<code>export</code> - A named list of objects to export to the worker environment</li>
</ul>
<p>The documentation for other arguments can be accessed by typing <code><a href="reference/Q.html">?Q</a></code>. Examples of using <code>const</code> and <code>export</code> would be:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adding a constant argument</span></span>
<span><span class="va">fx</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="fu"><a href="reference/Q.html">Q</a></span><span class="op">(</span><span class="va">fx</span>, x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, const<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, n_jobs<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># exporting an object to workers</span></span>
<span><span class="va">fx</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="fu"><a href="reference/Q.html">Q</a></span><span class="op">(</span><span class="va">fx</span>, x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, export<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, n_jobs<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We can also use <code>clustermq</code> as a parallel backend in <a href="https://cran.r-project.org/package=foreach" class="external-link"><code>foreach</code></a> or <a href="https://bioconductor.org/packages/release/bioc/html/BiocParallel.html" class="external-link"><code>BiocParallel</code></a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using foreach</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/register_dopar_cmq.html">register_dopar_cmq</a></span><span class="op">(</span>n_jobs<span class="op">=</span><span class="fl">2</span>, memory<span class="op">=</span><span class="fl">1024</span><span class="op">)</span> <span class="co"># see `?workers` for arguments</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="co"># this will be executed as jobs</span></span>
<span></span>
<span><span class="co"># using BiocParallel</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel" class="external-link">BiocParallel</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/DoparParam-class.html" class="external-link">DoparParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># after register_dopar_cmq(...)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/bplapply.html" class="external-link">bplapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="va">sqrt</span><span class="op">)</span></span></code></pre></div>
<p>More examples are available in <a href="https://mschubert.github.io/clustermq/articles/userguide.html" class="external-link">the User Guide</a>.</p>
</div>
<div class="section level2">
<h2 id="comparison-to-other-packages">Comparison to other packages<a class="anchor" aria-label="anchor" href="#comparison-to-other-packages"></a>
</h2>
<p>There are some packages that provide high-level parallelization of R function calls on a computing cluster. We compared <code>clustermq</code> to <code>BatchJobs</code> and <code>batchtools</code> for processing many short-running jobs, and found it to have approximately 1000x less overhead cost.</p>
<div class="float">
<img src="http://image.ibb.co/cRgYNR/plot.png" alt="Overhead comparison"><div class="figcaption">Overhead comparison</div>
</div>
<p>In short, use <code>clustermq</code> if you want:</p>
<ul>
<li>a one-line solution to run cluster jobs with minimal setup</li>
<li>access cluster functions from your local Rstudio via SSH</li>
<li>fast processing of many function calls without network storage I/O</li>
</ul>
<p>Use <a href="https://github.com/mllg/batchtools" class="external-link"><code>batchtools</code></a> if you:</p>
<ul>
<li>want to use a mature and well-tested package</li>
<li>don’t mind that arguments to every call are written to/read from disc</li>
<li>don’t mind there’s no load-balancing at run-time</li>
</ul>
<p>Use <a href="https://snakemake.readthedocs.io/en/latest/" class="external-link">Snakemake</a> or <a href="https://github.com/ropensci/targets" class="external-link"><code>targets</code></a> if:</p>
<ul>
<li>you want to design and run a workflow on HPC</li>
</ul>
<p>Don’t use <a href="https://cran.r-project.org/package=batch" class="external-link"><code>batch</code></a> (last updated 2013) or <a href="https://github.com/tudo-r/BatchJobs" class="external-link"><code>BatchJobs</code></a> (issues with SQLite on network-mounted storage).</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Contributions are welcome and they come in many different forms, shapes, and sizes. These include, but are not limited to:</p>
<ul>
<li>
<strong>Questions</strong>: Ask on the <a href="https://github.com/mschubert/clustermq/discussions" class="external-link">Github Discussions</a> board. If you are an advanced user, please also consider answering questions there.</li>
<li>
<strong>Bug reports</strong>: <a href="https://github.com/mschubert/clustermq/issues" class="external-link">File an issue</a> if something does not work as expected. Be sure to include a self-contained <a href="https://stackoverflow.com/help/minimal-reproducible-example" class="external-link">Minimal Reproducible Example</a> and set <code>log_worker=TRUE</code>.</li>
<li>
<strong>Code contributions</strong>: Have a look at the <a href="https://github.com/mschubert/clustermq/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22" class="external-link"><code>good first   issue</code></a> tag. Please discuss anything more complicated before putting a lot of work in, I’m happy to help you get started.</li>
</ul>
<blockquote>
<p>[!TIP] Check the <a href="https://mschubert.github.io/clustermq/articles/userguide.html" class="external-link">User Guide</a> and the <a href="https://mschubert.github.io/clustermq/articles/faq.html" class="external-link">FAQ</a> first, maybe your query is already answered there</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>This project is part of my academic work, for which I will be evaluated on citations. If you like me to be able to continue working on research support tools like <code>clustermq</code>, please cite the article when using it for publications:</p>
<blockquote>
<p>M Schubert. clustermq enables efficient parallelisation of genomic analyses. <em>Bioinformatics</em> (2019). <a href="https://doi.org/10.1093/bioinformatics/btz284" class="external-link">doi:10.1093/bioinformatics/btz284</a></p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=clustermq" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mschubert/clustermq/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mschubert/clustermq/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>Apache License (== 2.0) | file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing clustermq</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael Schubert <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-6862-5221" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>ZeroMQ authors <br><small class="roles"> Author, copyright holder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Schubert, ZeroMQ authors.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
